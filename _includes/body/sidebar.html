<hy-drawer
  id="_drawer"
  class="{% if include.cover %}cover{% endif %}"
  side="left"
  threshold="10"
  noscroll
  {% if include.cover or site.sidebar_drawer_opened %}opened{% endif %}
>
  <header id="_sidebar" class="sidebar{% if include.invert %} invert{% endif %}" role="banner">
    {% include_cached body/sidebar-bg.html image=include.image color=include.color theme_color=include.theme_color %}
    {% include_cached body/sidebar-sticky.html %}
  </header>
</hy-drawer>
{% if site.sidebar_drawer_opened %}
<script>
  (function () {
    var drawer = document.getElementById('_drawer');
    if (!drawer) return;

    var mobileQuery = window.matchMedia('(max-width: 63.99em)');

    var openDrawerOnMobile = function () {
      if (!mobileQuery.matches) return;

      if (drawer.opened === true) return;

      if (typeof drawer.open === 'function') {
        drawer.open();
        return;
      }

      drawer.setAttribute('opened', '');
    };

    var run = function () {
      if (mobileQuery.matches) {
        try {
          var state = history.state || {};
          state.closedOnce = false;
          history.replaceState(state, document.title);
        } catch (err) {}
      }

      // Hydejack may remove the opened attr on init; retry briefly on first load.
      var attempts = 0;
      var maxAttempts = 6;
      var tick = function () {
        openDrawerOnMobile();
        attempts += 1;
        if (attempts < maxAttempts && mobileQuery.matches && drawer.opened !== true) {
          window.setTimeout(tick, 180);
        }
      };
      tick();
    };

    if (drawer.classList.contains('loaded')) {
      run();
    } else {
      drawer.addEventListener('hy-drawer-init', run, { once: true });
    }

    window.addEventListener('load', run, { once: true });
  })();
</script>
{% endif %}
<hr class="sr-only" hidden />
