---
layout:   post
title:    "DI"
subtitle: "DI í•™ìŠµ"
category: Spring
more_posts: posts.md
tags:     Spring
---
# [Spring DI] @Autowared vs ìƒì„±ì ë°©ì‹

<!--more-->
<!-- Table of contents -->
* this unordered seed list will be replaced by the toc
{:toc}

<!-- text -->

## DI(Dependency Injection) ë°©ì‹
> DIëŠ” IoCì— ì˜í•´ ê´€ë¦¬ë˜ëŠ” ë¹ˆì„ ì£¼ì…í•˜ëŠ” ê¸°ìˆ ì´ë‹¤. Springì—ì„œëŠ” `@Autowired` ë°©ì‹ê³¼ ìƒì„±ì ë°©ì‹ì´ ìˆë‹¤.  
> ìµœê·¼ì—ëŠ” **ë¶ˆë³€ì„± ë³´ì¥(`final`), ìˆœí™˜ ì°¸ì¡° ë°©ì§€, í…ŒìŠ¤íŠ¸ í¸ì˜ì„±** ë“±ì˜ ì¥ì ìœ¼ë¡œ **ìƒì„±ì ì£¼ì… ë°©ì‹ì´ ì„ í˜¸**ëœë‹¤.  
> ìŠ¤í”„ë§ì€ **í•˜ë‚˜ì˜ ìƒì„±ìë§Œ ìˆì„ ê²½ìš° ìë™ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ì£¼ì…**í•œë‹¤.


@Autowiredê³¼ ìƒì„±ì ë°©ì‹ ëª¨ë‘ ë¦¬í”Œë ‰ì…˜ê³¼ BeanFactoryë¥¼ ì‚¬ìš©í•œë‹¤. ê·¸ëŸ¼ ë¦¬í”Œë ‰ì…˜ì´ë€ ë¬´ì—‡ì¸ê°€?
**ë¦¬í”Œë ‰ì…˜(Reflection)**ì€ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ ì¤‘ì— í´ë˜ìŠ¤ì˜ ë©”íƒ€ë°ì´í„°(í´ë˜ìŠ¤, ë©”ì„œë“œ, í•„ë“œ ë“±)ë¥¼ ë¶„ì„í•˜ê³  ì¡°ì‘í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì˜ë¯¸ í•œë‹¤.  
Javaì—ì„œ ë¦¬í”Œë ‰ì…˜ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” API(java.lang.reflect íŒ¨í‚¤ì§€ì˜ í´ë˜ìŠ¤ë“¤)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í•µì‹¬!
ì‹¤ì œë¡œ ìƒì„±ì ë°©ì‹ê³¼ @Autowaredê°€ ë¦¬í”Œë ‰ì…˜ê³¼ beanFactoryë¥¼ í†µí•´ ì–´ë–»ê²Œ ì˜ì¡´ì„±ì´ ì£¼ì…ë˜ëŠ” ê³¼ì •ì„ ë§Œë“¤ì–´ ë³´ì.  

### ìƒì„±ì ì£¼ì… ë°©ì‹
- Spring ì—†ì´ ì§ì ‘ BeanFactoryë¥¼ êµ¬í˜„í•´ì„œ ìƒì„±ì ì£¼ì… ë°©ì‹ì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.

BeanFactory í´ë˜ìŠ¤ (ìƒì„±ì ì£¼ì…)
```java
import java.lang.reflect.Constructor;
import java.util.HashMap;
import java.util.Map;

class SimpleBeanFactory {
    private final Map<Class<?>, Object> beans = new HashMap<>();

    // ìˆ˜ë™ìœ¼ë¡œ ë¹ˆ ë“±ë¡ (Springì˜ @ComponentScan ì—­í• )
    public void addSingletonBean(Class<?> clazz, Object instance) {
        beans.put(clazz, instance);
    }

    // ìƒì„±ì ì£¼ì…ì„ í™œìš©í•œ ë¹ˆ ë“±ë¡
    public void registerBean(Class<?> clazz) throws Exception {
        Constructor<?> constructor = clazz.getConstructors()[0]; // ì²« ë²ˆì§¸ ìƒì„±ì ê°€ì ¸ì˜¤ê¸°
        Class<?>[] parameterTypes = constructor.getParameterTypes();
        Object[] dependencies = new Object[parameterTypes.length];

        // ìƒì„±ìì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ í™•ì¸í•˜ê³  í•„ìš”í•œ ë¹ˆì„ ì°¾ì•„ì„œ ì£¼ì…
        for (int i = 0; i < parameterTypes.length; i++) {
            dependencies[i] = beans.get(parameterTypes[i]);
            if (dependencies[i] == null) {
                throw new IllegalStateException("No bean found for dependency: " + parameterTypes[i].getName());
            }
        }

        // ë¦¬í”Œë ‰ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ê°ì²´ ìƒì„± í›„ ë¹ˆìœ¼ë¡œ ë“±ë¡
        Object instance = constructor.newInstance(dependencies);
        beans.put(clazz, instance);
    }

    // ë¹ˆ ì¡°íšŒ
    public <T> T getBean(Class<T> clazz) {
        return clazz.cast(beans.get(clazz));
    }
}
```

UserRepository
```java
class UserRepository {
    public String findUser() {
        return "User found!";
    }
}
```

UserService
```java

// UserServiceëŠ” UserRepositoryë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ê°€ì§
class UserService {
    private final UserRepository userRepository;

    public UserService(UserRepository userRepository) { // ìƒì„±ì ì£¼ì…
        this.userRepository = userRepository;
    }

    public void execute() {
        System.out.println(userRepository.findUser());
    }
}

```

ì‹¤í–‰ ì½”ë“œ (ìƒì„±ì ì£¼ì… ë°©ì‹ í…ŒìŠ¤íŠ¸)
```java
public class ConstructorInjectionExample {
    public static void main(String[] args) throws Exception {
        SimpleBeanFactory beanFactory = new SimpleBeanFactory();

        // UserRepositoryë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡ (Springì—ì„œ @ComponentScanìœ¼ë¡œ ë¹ˆ ë“±ë¡í•˜ëŠ” ê²ƒê³¼ ë™ì¼)
        beanFactory.addSingletonBean(UserRepository.class, new UserRepository());

        // UserServiceë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡ (ìƒì„±ì ì£¼ì… ë°©ì‹ìœ¼ë¡œ ì˜ì¡´ì„± ì£¼ì…)
        beanFactory.registerBean(UserService.class);

        // ë¹ˆ ê°€ì ¸ì™€ì„œ ì‹¤í–‰
        UserService userService = beanFactory.getBean(UserService.class);
        userService.execute(); // "User found!" ì¶œë ¥
    }
}

```

ì‹¤í–‰ ê²°ê³¼
```shell
User found!
```

### `@Autowired` ë°©ì‹ êµ¬í˜„
> ì´ë²ˆì—ëŠ” **ë¦¬í”Œë ‰ì…˜ì„ ì‚¬ìš©í•´ì„œ `@Autowired` í•„ë“œ ì£¼ì… ë°©ì‹**ì„ ì§ì ‘ êµ¬í˜„í•´ë³´ì.

`@Autowired` ì• ë…¸í…Œì´ì…˜ì„ ì§ì ‘ êµ¬í˜„
```java
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;

@Retention(RetentionPolicy.RUNTIME)
@interface Autowired {} // ì»¤ìŠ¤í…€ ì• ë…¸í…Œì´ì…˜
```


BeanFactory í´ë˜ìŠ¤ (`@Autowired`ë¥¼ ì²˜ë¦¬)
```java
import java.lang.reflect.Field;
import java.util.HashMap;
import java.util.Map;

class AutowiredBeanFactory {
    private final Map<Class<?>, Object> beans = new HashMap<>();

    // ìˆ˜ë™ìœ¼ë¡œ ë¹ˆ ë“±ë¡ (Springì˜ @ComponentScan ì—­í• )
    public void addSingletonBean(Class<?> clazz, Object instance) {
        beans.put(clazz, instance);
    }

    // @Autowired í•„ë“œ ì£¼ì… ë°©ì‹ ì§€ì›
    public void registerBean(Class<?> clazz) throws Exception {
        Object instance = clazz.getDeclaredConstructor().newInstance();
        beans.put(clazz, instance);

        // í•„ë“œì— @Autowiredê°€ ë¶™ì–´ ìˆëŠ”ì§€ í™•ì¸
        for (Field field : clazz.getDeclaredFields()) {
            if (field.isAnnotationPresent(Autowired.class)) {
                Class<?> dependencyType = field.getType();
                Object dependency = beans.get(dependencyType);

                if (dependency == null) {
                    throw new IllegalStateException("No bean found for dependency: " + dependencyType.getName());
                }

                // private í•„ë“œ ì ‘ê·¼ í—ˆìš©
                field.setAccessible(true);
                field.set(instance, dependency);
            }
        }
    }

    // ë¹ˆ ì¡°íšŒ
    public <T> T getBean(Class<T> clazz) {
        return clazz.cast(beans.get(clazz));
    }
}
```

`@Autowired`ë¥¼ ì‚¬ìš©í•œ í´ë˜ìŠ¤
```java
class UserRepository {
    public String findUser() {
        return "User found!";
    }
}

// @Autowiredë¥¼ ì‚¬ìš©í•˜ëŠ” UserService í´ë˜ìŠ¤
class UserService {
    @Autowired
    private UserRepository userRepository; // í•„ë“œ ì£¼ì…

    public void execute() {
        System.out.println(userRepository.findUser());
    }
}
```

ì‹¤í–‰ ì½”ë“œ (`@Autowired` ë°©ì‹ í…ŒìŠ¤íŠ¸)
```java
public class AutowiredInjectionExample {
    public static void main(String[] args) throws Exception {
        AutowiredBeanFactory beanFactory = new AutowiredBeanFactory();

        // UserRepositoryë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡
        beanFactory.addSingletonBean(UserRepository.class, new UserRepository());

        // UserServiceë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡ (í•„ë“œ ì£¼ì… ë°©ì‹ ì‚¬ìš©)
        beanFactory.registerBean(UserService.class);

        // ë¹ˆ ê°€ì ¸ì™€ì„œ ì‹¤í–‰
        UserService userService = beanFactory.getBean(UserService.class);
        userService.execute(); // "User found!" ì¶œë ¥
    }
}
```

ì‹¤í–‰ ê²°ê³¼
```
User found!
```

## **ğŸ“Œ ìƒì„±ì ì£¼ì… vs `@Autowired` ì£¼ì… ë‚´ë¶€ ë™ì‘ ë¹„êµ**

| ì£¼ì… ë°©ì‹ | ë‚´ë¶€ ë™ì‘ ë°©ì‹ |
|-----------|------------------------------------------------|
| **ìƒì„±ì ì£¼ì…** | `BeanFactory`ê°€ ìƒì„±ìë¥¼ ë¶„ì„í•˜ê³ , í•„ìš”í•œ ë¹ˆì„ ì°¾ì•„ì„œ `newInstance()` í˜¸ì¶œ |
| **`@Autowired` (í•„ë“œ ì£¼ì…)** | `BeanFactory`ê°€ ë¦¬í”Œë ‰ì…˜ì„ ì‚¬ìš©í•´ `private` í•„ë“œì— ë¹ˆì„ ê°•ì œ ì£¼ì… |

âœ… **ìƒì„±ì ì£¼ì…ì€ `new`ë¥¼ í˜¸ì¶œí•  ë•Œ BeanFactoryê°€ ì£¼ì…í•  ë¹ˆì„ ì°¾ì•„ì„œ ìƒì„±ì ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ì‹**  
âœ… **`@Autowired`ëŠ” ë¦¬í”Œë ‰ì…˜ì„ ì‚¬ìš©í•´ì„œ private í•„ë“œì— ê°•ì œë¡œ ë¹ˆì„ ì£¼ì…í•˜ëŠ” ë°©ì‹**  
âœ… **Spring ë‚´ë¶€ì—ì„œëŠ” ì´ ê³¼ì •ì´ ìë™ìœ¼ë¡œ ì´ë£¨ì–´ì§€ê³ , ìš°ë¦¬ëŠ” `ApplicationContext`ë¥¼ í†µí•´ ë¹ˆì„ ê°€ì ¸ì˜¤ê¸°ë§Œ í•˜ë©´ ë¨!**
