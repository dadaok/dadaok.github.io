---
layout:   post
title:    "Filter"
subtitle: "Filter í•™ìŠµ"
category: Spring
more_posts: posts.md
tags:     Spring
---
# [Java & Spring Filter] Filter

<!--more-->
<!-- Table of contents -->
* this unordered seed list will be replaced by the toc
{:toc}

<!-- text -->


# **Springì—ì„œ í•„í„°(Filter) ê´€ë ¨ ì •ë¦¬**

Springì—ì„œ **í•„í„°(Filter)**ëŠ” **í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ê°€ë¡œì±„ì„œ ì‚¬ì „/ì‚¬í›„ ì²˜ë¦¬í•˜ëŠ” ê¸°ëŠ¥**ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.  
Spring Bootì—ì„œëŠ” **ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì™€ Spring ì»¨í…ìŠ¤íŠ¸ê°€ ë”°ë¡œ ì¡´ì¬**í•˜ë©°, í•„í„°ëŠ” ì›ë˜ **ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸(ServletContext)ì—ì„œ ì‹¤í–‰**ë©ë‹ˆë‹¤.  
ê·¸ëŸ¬ë‚˜ **Spring Bootì—ì„œëŠ” `FilterRegistrationBean`ì„ ì‚¬ìš©í•˜ì—¬ Spring ì»¨í…ìŠ¤íŠ¸ì˜ ë¹ˆì„ í•„í„°ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

---

## **1. í•„í„°(Filter)ì˜ ê°œë…**
### âœ… **í•„í„°ë€?**
- **ìš”ì²­(Request)ê³¼ ì‘ë‹µ(Response)ì„ ê°€ë¡œì±„ì„œ ì „ì²˜ë¦¬/í›„ì²˜ë¦¬í•˜ëŠ” ì—­í• **.
- **ì„œë¸”ë¦¿(Servlet) ê¸°ë°˜ì—ì„œ ë™ì‘**í•˜ë©°, Spring MVCì˜ `DispatcherServlet` ì´ì „ì— ì‹¤í–‰ë¨.
- **ì£¼ë¡œ ë³´ì•ˆ(ì¸ì¦, CORS), ë¡œê¹…, ë°ì´í„° ë³€í™˜, ì‘ë‹µ ì••ì¶• ë“±ì— ì‚¬ìš©**ë¨.

### âœ… **í•„í„°ì™€ ì¸í„°ì…‰í„°ì˜ ì°¨ì´ì **
| ë¹„êµ í•­ëª© | í•„í„° (Filter) | ì¸í„°ì…‰í„° (Interceptor) |
|------|-------------|----------------|
| **ì‹¤í–‰ ìœ„ì¹˜** | **DispatcherServlet ì´ì „** (ì„œë¸”ë¦¿ ë ˆë²¨) | **DispatcherServlet ì´í›„** (Spring MVC ë ˆë²¨) |
| **ì ìš© ë²”ìœ„** | **ëª¨ë“  ìš”ì²­** (ì •ì  ë¦¬ì†ŒìŠ¤ í¬í•¨) | **Spring MVC ì»¨íŠ¸ë¡¤ëŸ¬ ìš”ì²­ë§Œ ì ìš©** |
| **ì‚¬ìš© ëª©ì ** | CORS, ë¡œê¹…, ë³´ì•ˆ, ì¸ì½”ë”© ì„¤ì • | ì¸ì¦, ê¶Œí•œ ì²´í¬, ë¡œê¹…, íŠ¸ëœì­ì…˜ ê´€ë¦¬ |
| **ë“±ë¡ ë°©ì‹** | `FilterRegistrationBean` ë˜ëŠ” `@Component` | `WebMvcConfigurer`ì—ì„œ `addInterceptors()` |
| **Spring Security ì˜í–¥** | Security Filter Chain **ì•**ì—ì„œ ë™ì‘ | Security í•„í„° ì´í›„ ë™ì‘ ê°€ëŠ¥ |

---

## **2. í•„í„°(Filter) êµ¬í˜„ ë° ë“±ë¡ ë°©ë²•**
Spring Bootì—ì„œëŠ” **3ê°€ì§€ ë°©ë²•**ìœ¼ë¡œ í•„í„°ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### âœ… **ë°©ë²• 1: `FilterRegistrationBean`ì„ ì‚¬ìš©í•œ ìˆ˜ë™ ë“±ë¡ (ì¶”ì²œ)**
- **Spring ì»¨í…ìŠ¤íŠ¸ì—ì„œ í•„í„°ë¥¼ ê´€ë¦¬**í•˜ë©´ì„œ, **ì‹¤í–‰ ìˆœì„œë¥¼ ì œì–´í•  ìˆ˜ ìˆìŒ**.
- **í•„í„°ì—ì„œ `@Autowired` ë¹ˆì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ**.

```java
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class FilterConfig {

    private final SomeService someService;

    public FilterConfig(SomeService someService) {
        this.someService = someService;
    }

    @Bean
    public FilterRegistrationBean<CustomFilter> loggingFilter() {
        FilterRegistrationBean<CustomFilter> registrationBean = new FilterRegistrationBean<>();
        registrationBean.setFilter(new CustomFilter(someService)); // âœ… ë¹ˆ ì£¼ì… ê°€ëŠ¥
        registrationBean.addUrlPatterns("/*"); // ëª¨ë“  ìš”ì²­ì— í•„í„° ì ìš©
        registrationBean.setOrder(1); // í•„í„° ì‹¤í–‰ ìˆœì„œ ì§€ì •
        return registrationBean;
    }
}
```
**í•„í„° í´ë˜ìŠ¤ êµ¬í˜„**
```java
import javax.servlet.*;
import java.io.IOException;

public class CustomFilter implements Filter {

    private final SomeService someService;

    public CustomFilter(SomeService someService) {
        this.someService = someService;
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        someService.doSomething(); // âœ… Spring ë¹ˆ ì‚¬ìš© ê°€ëŠ¥
        chain.doFilter(request, response);
    }
}
```
ğŸ“Œ **Spring ì»¨í…ìŠ¤íŠ¸ì—ì„œ í•„í„°ë¥¼ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— `@Autowired` ë¹ˆì„ ì£¼ì…í•  ìˆ˜ ìˆìŒ!**  
ğŸ“Œ **í•„í„° ì‹¤í–‰ ìˆœì„œ(`setOrder`)ë¥¼ ì§€ì •í•  ìˆ˜ ìˆì–´ ë‹¤ë¥¸ í•„í„°ë³´ë‹¤ ë¨¼ì €/ë‚˜ì¤‘ì— ì‹¤í–‰ ê°€ëŠ¥.**

---

### âœ… **ë°©ë²• 2: `@Component`ë¥¼ ì‚¬ìš©í•œ ìë™ ë“±ë¡**
- **Springì´ ìë™ìœ¼ë¡œ í•„í„°ë¥¼ ê°ì§€í•˜ì—¬ ë“±ë¡**.
- **Spring ë¹ˆì„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì‹¤í–‰ ìˆœì„œ ì œì–´ê°€ ì–´ë ¤ì›€**.

```java
import org.springframework.stereotype.Component;
import javax.servlet.*;
import java.io.IOException;

@Component // âœ… í•„í„°ë¥¼ Spring ë¹ˆìœ¼ë¡œ ë“±ë¡
public class CustomFilter implements Filter {

    private final SomeService someService;

    public CustomFilter(SomeService someService) {
        this.someService = someService;
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        someService.doSomething();
        chain.doFilter(request, response);
    }
}
```
ğŸ“Œ **ë‹¨ì :** `@Component`ë¡œ ë“±ë¡í•˜ë©´ ì‹¤í–‰ ìˆœì„œë¥¼ `setOrder`ë¡œ ì§€ì •í•  ìˆ˜ ì—†ìŒ.

---

### âœ… **ë°©ë²• 3: `@WebFilter`ë¥¼ ì‚¬ìš©í•œ ì„œë¸”ë¦¿ ê¸°ë°˜ ë“±ë¡**
- **Springê³¼ ë¬´ê´€í•˜ê²Œ ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì—ì„œ í•„í„°ë¥¼ ë“±ë¡**.
- **Springì˜ ë¹ˆì„ ì§ì ‘ ì£¼ì…í•  ìˆ˜ ì—†ìŒ**.

```java
import javax.servlet.*;
import javax.servlet.annotation.WebFilter;
import java.io.IOException;

@WebFilter(urlPatterns = "/*") // âœ… ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì—ì„œ í•„í„° ë“±ë¡
public class CustomFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        System.out.println("Request received");
        chain.doFilter(request, response);
    }
}
```
ğŸ“Œ **ë‹¨ì :** Spring ë¹ˆì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ â†’ `SomeService someService;`ë¥¼ ì£¼ì…í•˜ë©´ `NullPointerException` ë°œìƒ.

---

## **3. í•„í„°ì—ì„œ ë¹ˆ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€**
| ë°©ë²• | ë¹ˆ(@Autowired) ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ | ì‹¤í–‰ ìˆœì„œ ì§€ì • ê°€ëŠ¥ ì—¬ë¶€ |
|------|----------------|----------------|
| **FilterRegistrationBean ì‚¬ìš© (ì¶”ì²œ)** | âœ… ê°€ëŠ¥ | âœ… ê°€ëŠ¥ |
| **@Component ì‚¬ìš©** | âœ… ê°€ëŠ¥ | âŒ ë¶ˆê°€ëŠ¥ |
| **@WebFilter ì‚¬ìš© (ì„œë¸”ë¦¿ ë°©ì‹)** | âŒ ë¶ˆê°€ëŠ¥ | âŒ ë¶ˆê°€ëŠ¥ |

âœ… **í•„í„°ì—ì„œ ë¹ˆì„ ì‚¬ìš©í•˜ë ¤ë©´ `FilterRegistrationBean`ì„ ì‚¬ìš©í•´ì•¼ í•¨!**  
ğŸš¨ **`@WebFilter`ëŠ” ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë˜ë¯€ë¡œ ë¹ˆì„ ì£¼ì…í•  ìˆ˜ ì—†ìŒ.**

---

## **4. í•„í„° ì‹¤í–‰ ìˆœì„œ**
í•„í„°ëŠ” ì‹¤í–‰ ìˆœì„œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **âœ… í•„í„° ì‹¤í–‰ ìˆœì„œ ì§€ì • (`setOrder`)**
```java
@Bean
public FilterRegistrationBean<FirstFilter> firstFilter() {
    FilterRegistrationBean<FirstFilter> registrationBean = new FilterRegistrationBean<>();
    registrationBean.setFilter(new FirstFilter());
    registrationBean.setOrder(1); // ê°€ì¥ ë¨¼ì € ì‹¤í–‰
    return registrationBean;
}

@Bean
public FilterRegistrationBean<SecondFilter> secondFilter() {
    FilterRegistrationBean<SecondFilter> registrationBean = new FilterRegistrationBean<>();
    registrationBean.setFilter(new SecondFilter());
    registrationBean.setOrder(2); // ë‘ ë²ˆì§¸ ì‹¤í–‰
    return registrationBean;
}
```
ğŸ“Œ **ë‚®ì€ ìˆ«ìì˜ í•„í„°ê°€ ë¨¼ì € ì‹¤í–‰ë¨!**  
ğŸ“Œ **ì¸í„°ì…‰í„°ë³´ë‹¤ í•„í„°ê°€ ë¨¼ì € ì‹¤í–‰ë¨.**

---

## **5. í•„í„° ì‹¤í–‰ íë¦„**
```plaintext
[í´ë¼ì´ì–¸íŠ¸ ìš”ì²­] 
    â†’ í•„í„°(Filter) ì‹¤í–‰ (ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸)
    â†’ DispatcherServlet ì‹¤í–‰ (Spring ì»¨í…ìŠ¤íŠ¸)
    â†’ ì¸í„°ì…‰í„°(Interceptor) ì‹¤í–‰
    â†’ ì»¨íŠ¸ë¡¤ëŸ¬(Controller) ì‹¤í–‰
    â†’ ì¸í„°ì…‰í„°(Interceptor) ì‹¤í–‰ (afterCompletion)
    â†’ DispatcherServlet ë°˜í™˜
    â†’ í•„í„°(Filter) ì‹¤í–‰
    â†’ [í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ]
```

âœ… **í•„í„°ëŠ” ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰ë˜ë¯€ë¡œ, `DispatcherServlet`ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ë¨.**  
âœ… **ì¸í„°ì…‰í„°ëŠ” `DispatcherServlet` ì´í›„ì— ì‹¤í–‰ë¨.**

---

## **6. ê²°ë¡ **
ğŸš€ **í•„í„°ëŠ” Spring IoC ì»¨í…ìŠ¤íŠ¸ì™€ ë¬´ê´€í•˜ì§€ë§Œ, `FilterRegistrationBean`ì„ ì‚¬ìš©í•˜ë©´ Spring ë¹ˆì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.**  
ğŸ”¥ **í•„í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `FilterRegistrationBean`ì„ ì¶”ì²œ!** (`@Component`ë„ ê°€ëŠ¥í•˜ì§€ë§Œ ì‹¤í–‰ ìˆœì„œ ì¡°ì •ì´ ì–´ë ¤ì›€.)  
ğŸ’¡ **ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰ë˜ëŠ” í•„í„°ì™€ Spring ì»¨í…ìŠ¤íŠ¸ì˜ ì°¨ì´ë¥¼ ì´í•´í•˜ë©´ í•„í„°ë¥¼ ë” íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆìŒ!** ğŸš€

---

# í•„í„° ì¢…ë¥˜ ë° CORS, XSS ì˜ˆì‹œ

---

## **1. Springì—ì„œ ì œê³µí•˜ëŠ” ì£¼ìš” í•„í„° ì¢…ë¥˜**
Springì€ **`javax.servlet.Filter`**ë¿ë§Œ ì•„ë‹ˆë¼, ëª‡ ê°€ì§€ **ìœ ìš©í•œ í•„í„° í´ë˜ìŠ¤**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### âœ… **1.1. `OncePerRequestFilter` (í•œ ìš”ì²­ë‹¹ í•œ ë²ˆë§Œ ì‹¤í–‰)**
- **í•œ ìš”ì²­ì— ëŒ€í•´ í•„í„°ê°€ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ë³´ì¥**í•˜ëŠ” Spring ì œê³µ í•„í„°.
- ê¸°ë³¸ í•„í„°(`Filter` ì¸í„°í˜ì´ìŠ¤)ë¥¼ ì‚¬ìš©í•˜ë©´ ê°™ì€ ìš”ì²­ì´ ì—¬ëŸ¬ ë²ˆ í•„í„°ë§ë  ìˆ˜ë„ ìˆìŒ.
- `OncePerRequestFilter`ë¥¼ í™•ì¥í•˜ë©´ **ë™ì¼í•œ ìš”ì²­ì— ëŒ€í•´ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥ë¨**.

**ğŸ“Œ ì˜ˆì œ: ìš”ì²­ ë¡œê¹… í•„í„°**
```java
import org.springframework.web.filter.OncePerRequestFilter;
import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class LoggingFilter extends OncePerRequestFilter {

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, 
                                    FilterChain filterChain) throws ServletException, IOException {
        System.out.println("LoggingFilter: " + request.getRequestURI());
        filterChain.doFilter(request, response);
    }
}
```

---

### âœ… **1.2. `CharacterEncodingFilter` (ë¬¸ì ì¸ì½”ë”© ì„¤ì •)**
- ìš”ì²­ê³¼ ì‘ë‹µì˜ **ë¬¸ì ì¸ì½”ë”©(UTF-8 ë“±)ì„ ì„¤ì •**í•˜ëŠ” í•„í„°.
- Spring Bootì—ì„œëŠ” ìë™ìœ¼ë¡œ ë“±ë¡ë˜ì§€ë§Œ, ì„¤ì •ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ë„ ìˆìŒ.

```java
import org.springframework.web.filter.CharacterEncodingFilter;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class FilterConfig {

    @Bean
    public CharacterEncodingFilter encodingFilter() {
        CharacterEncodingFilter filter = new CharacterEncodingFilter();
        filter.setEncoding("UTF-8");
        filter.setForceEncoding(true);
        return filter;
    }
}
```
ğŸ“Œ **ìš”ì²­ê³¼ ì‘ë‹µì˜ ì¸ì½”ë”©ì„ UTF-8ë¡œ ì„¤ì •í•˜ì—¬ í•œê¸€ ê¹¨ì§ ë°©ì§€**.

---

### âœ… **1.3. `CorsFilter` (CORS ì²˜ë¦¬)**
- CORS(Cross-Origin Resource Sharing) ì •ì±…ì„ ì ìš©í•˜ëŠ” í•„í„°.
- ì™¸ë¶€ ë„ë©”ì¸ì—ì„œ APIë¥¼ í˜¸ì¶œí•  ë•Œ **ë¸Œë¼ìš°ì €ì—ì„œ ì°¨ë‹¨ë˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°**í•¨.

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import org.springframework.web.filter.CorsFilter;

@Configuration
public class CorsConfig {

    @Bean
    public CorsFilter corsFilter() {
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedOrigin("*"); // ëª¨ë“  ë„ë©”ì¸ í—ˆìš©
        config.addAllowedMethod("*"); // ëª¨ë“  HTTP ë©”ì„œë“œ í—ˆìš©
        config.addAllowedHeader("*"); // ëª¨ë“  í—¤ë” í—ˆìš©
        source.registerCorsConfiguration("/**", config);
        return new CorsFilter(source);
    }
}
```
ğŸ“Œ **ëª¨ë“  ë„ë©”ì¸ì—ì„œ APIë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ CORS ì„¤ì • ì ìš©**.

---

### âœ… **1.4. `HiddenHttpMethodFilter` (RESTful API ì§€ì›)**
- HTML `<form>` íƒœê·¸ëŠ” `GET`ê³¼ `POST`ë§Œ ì§€ì›í•˜ì§€ë§Œ, **PUT, DELETE ë“±ì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë³€í™˜**í•´ì¤Œ.
- `PUT`, `DELETE` ìš”ì²­ì„ `POST` ìš”ì²­ìœ¼ë¡œ ë³´ë‚´ë©´ì„œ `_method` íŒŒë¼ë¯¸í„°ë¥¼ í¬í•¨í•˜ë©´ ë³€í™˜ë¨.

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.filter.HiddenHttpMethodFilter;

@Configuration
public class FilterConfig {

    @Bean
    public HiddenHttpMethodFilter hiddenHttpMethodFilter() {
        return new HiddenHttpMethodFilter();
    }
}
```
ğŸ“Œ **HTML í¼ì—ì„œ `_method=PUT`ì„ ë³´ë‚´ë©´, ì‹¤ì œë¡œëŠ” `PUT` ìš”ì²­ìœ¼ë¡œ ì²˜ë¦¬ë¨**.

---

## **2. CORS ì²˜ë¦¬ ì˜ˆì œ (`CorsFilter`)**
ğŸ“Œ **CORS(Cross-Origin Resource Sharing) ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ í•„í„°ë¥¼ ì ìš©í•˜ëŠ” ë°©ë²•**

### **âœ… 2.1. `CorsFilter`ë¥¼ ì‚¬ìš©í•œ CORS ì²˜ë¦¬**
```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import org.springframework.web.filter.CorsFilter;

@Configuration
public class CorsConfig {

    @Bean
    public CorsFilter corsFilter() {
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedOrigin("*"); // ëª¨ë“  ë„ë©”ì¸ í—ˆìš©
        config.addAllowedMethod("*"); // ëª¨ë“  HTTP ë©”ì„œë“œ í—ˆìš©
        config.addAllowedHeader("*"); // ëª¨ë“  í—¤ë” í—ˆìš©
        source.registerCorsConfiguration("/**", config);
        return new CorsFilter(source);
    }
}
```
ğŸ“Œ **ëª¨ë“  ë„ë©”ì¸, ë©”ì„œë“œ, í—¤ë”ë¥¼ í—ˆìš©í•˜ì—¬ CORS ë¬¸ì œ í•´ê²°.**

---

### **âœ… 2.2. `WebMvcConfigurer`ë¥¼ ì‚¬ìš©í•œ CORS ì„¤ì •**
```java
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**") // `/api/` ê²½ë¡œì—ë§Œ ì ìš©
                .allowedOrigins("https://example.com") // íŠ¹ì • ë„ë©”ì¸ í—ˆìš©
                .allowedMethods("GET", "POST", "PUT", "DELETE")
                .allowedHeaders("*")
                .allowCredentials(true);
    }
}
```
ğŸ“Œ **íŠ¹ì • ë„ë©”ì¸ì—ì„œë§Œ APIë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ì œí•œ ê°€ëŠ¥**.

---

## **3. XSS(Cross-Site Scripting) ë°©ì–´ í•„í„°**
ğŸ“Œ **XSS ê³µê²©ì„ ë°©ì–´í•˜ëŠ” ë°©ë²•**
- ì‚¬ìš©ìê°€ ì…ë ¥í•œ **ì•…ì„± JavaScript ì½”ë“œê°€ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ë°©ì§€**.
- `HttpServletRequestWrapper`ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì…ë ¥ ê°’ì„ í•„í„°ë§**í•¨.

### **âœ… XSS ë°©ì–´ í•„í„°**
```java
import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import java.io.IOException;

public class XssFilter implements Filter {

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        XssRequestWrapper wrappedRequest = new XssRequestWrapper((HttpServletRequest) request);
        chain.doFilter(wrappedRequest, response);
    }
}
```

---

### **âœ… `HttpServletRequestWrapper`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì…ë ¥ ê°’ í•„í„°ë§**
```java
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletRequestWrapper;

public class XssRequestWrapper extends HttpServletRequestWrapper {

    public XssRequestWrapper(HttpServletRequest request) {
        super(request);
    }

    @Override
    public String getParameter(String name) {
        String value = super.getParameter(name);
        return sanitize(value);
    }

    @Override
    public String[] getParameterValues(String name) {
        String[] values = super.getParameterValues(name);
        if (values == null) return null;

        for (int i = 0; i < values.length; i++) {
            values[i] = sanitize(values[i]);
        }
        return values;
    }

    private String sanitize(String input) {
        return input == null ? null : input.replaceAll("<", "&lt;")
                                           .replaceAll(">", "&gt;")
                                           .replaceAll("\"", "&quot;")
                                           .replaceAll("'", "&#x27;")
                                           .replaceAll("&", "&amp;");
    }
}
```
ğŸ“Œ **ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ì—ì„œ `<script>` íƒœê·¸ì™€ ê°™ì€ ì•…ì„± ì½”ë“œê°€ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ë³€í™˜**.

---

### **âœ… XSS í•„í„°ë¥¼ Springì— ë“±ë¡**
```java
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class XssFilterConfig {

    @Bean
    public FilterRegistrationBean<XssFilter> xssFilterRegistration() {
        FilterRegistrationBean<XssFilter> registrationBean = new FilterRegistrationBean<>();
        registrationBean.setFilter(new XssFilter());
        registrationBean.addUrlPatterns("/*"); // ëª¨ë“  ìš”ì²­ì— ì ìš©
        registrationBean.setOrder(1); // í•„í„° ì‹¤í–‰ ìˆœì„œ ì§€ì •
        return registrationBean;
    }
}
```
ğŸ“Œ **ëª¨ë“  ìš”ì²­ì—ì„œ XSS ê³µê²©ì„ ìë™ìœ¼ë¡œ ë°©ì–´**.

---

## **ğŸ“Œ ì •ë¦¬**
- `OncePerRequestFilter`: í•œ ìš”ì²­ë‹¹ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ëŠ” í•„í„°.
- `CorsFilter`: CORS ë¬¸ì œ í•´ê²°.
- `CharacterEncodingFilter`: UTF-8 ì¸ì½”ë”© ì ìš©.
- `HiddenHttpMethodFilter`: RESTful API ì§€ì›.
- **XSS í•„í„°**: ì‚¬ìš©ìì˜ ì…ë ¥ ê°’ì—ì„œ `<script>`ì™€ ê°™ì€ ì•…ì„± ì½”ë“œ ì°¨ë‹¨.

ğŸš€ **í•„í„°ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•˜ë©´ ë³´ì•ˆê³¼ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŒ!**